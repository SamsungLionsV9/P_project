# Car-Sentix 시스템 아키텍처

## 📋 프로젝트 개요
**Car-Sentix**는 중고차 가격 예측 및 AI 기반 구매 타이밍 분석 플랫폼입니다.
머신러닝(XGBoost)과 LLM(Groq)을 결합하여 스마트한 중고차 구매 의사결정을 지원합니다.

## 🏗️ 시스템 아키텍처 다이어그램

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           CLIENT LAYER                                   │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌──────────────────┐    ┌──────────────────┐    ┌──────────────────┐   │
│  │   Flutter App    │    │   Web Browser    │    │   CLI Tools      │   │
│  │  (Mobile/Web)    │    │  (Swagger UI)    │    │  (src/*.py)      │   │
│  └────────┬─────────┘    └────────┬─────────┘    └────────┬─────────┘   │
│           │                       │                       │              │
└───────────┼───────────────────────┼───────────────────────┼──────────────┘
            │                       │                       │
            ▼                       ▼                       ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           API GATEWAY LAYER                              │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────┐    ┌─────────────────────────────────┐ │
│  │     User Service (8080)     │    │     ML Service (8000)           │ │
│  │     Spring Boot 3.2         │    │     FastAPI + Uvicorn           │ │
│  │     ─────────────────       │    │     ─────────────────           │ │
│  │     • JWT 인증              │───▶│     • 가격 예측 (XGBoost)       │ │
│  │     • OAuth2 소셜 로그인    │    │     • 타이밍 분석               │ │
│  │     • 사용자 관리           │    │     • AI 분석 (Groq LLM)        │ │
│  │     • 차량 데이터 관리      │    │     • 추천/유사 차량            │ │
│  └──────────────┬──────────────┘    └──────────────┬──────────────────┘ │
│                 │                                   │                    │
└─────────────────┼───────────────────────────────────┼────────────────────┘
                  │                                   │
                  ▼                                   ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                           DATA LAYER                                     │
├─────────────────────────────────────────────────────────────────────────┤
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────────────────────┐│
│  │   H2 (Dev)    │  │ MySQL (Prod)  │  │     External APIs             ││
│  │   ─────────   │  │ ─────────     │  │     ─────────────             ││
│  │   • Users     │  │ • Users       │  │     • 한국은행 API            ││
│  │   • Cars      │  │ • Cars        │  │     • 네이버 데이터랩         ││
│  │   • Schedules │  │ • History     │  │     • Yahoo Finance           ││
│  └───────────────┘  └───────────────┘  │     • Groq LLM API            ││
│                                         └───────────────────────────────┘│
└─────────────────────────────────────────────────────────────────────────┘
```

## 📁 디렉토리 구조 상세

### 서비스별 책임 (Responsibility)

| 서비스 | 포트 | 기술 스택 | 책임 |
|--------|------|-----------|------|
| ML Service | 8000 | FastAPI, XGBoost, Groq | 가격 예측, AI 분석, 타이밍 계산 |
| User Service | 8080 | Spring Boot 3.2, JPA | 사용자 인증, 데이터 관리, API 게이트웨이 |
| Flutter App | - | Flutter, Dart | UI/UX, 상태 관리, API 호출 |

## 🔄 데이터 흐름 (Data Flow)

### 1. 가격 예측 흐름
```
[사용자 입력] → [Flutter App] → [User Service 인증] → [ML Service /predict]
                                                              │
                                                              ▼
                                                      [XGBoost 모델]
                                                              │
                                                              ▼
                                                    [예측 가격 + 신뢰도]
```

### 2. 스마트 분석 흐름
```
[차량 정보] → [ML Service /analyze]
                    │
     ┌──────────────┼──────────────┐
     ▼              ▼              ▼
[가격 예측]    [타이밍 분석]   [Groq AI 분석]
     │              │              │
     └──────────────┼──────────────┘
                    ▼
           [통합 분석 결과]
           • 예측 가격
           • 매수/매도 신호
           • AI 어드바이스
```

## 📚 용어집 (Ubiquitous Language)

| 용어 | 정의 |
|------|------|
| **예측 가격** | XGBoost 모델이 산출한 중고차 예상 시장가격 |
| **타이밍 점수** | 0~100점, 현재 구매 적절성 (높을수록 좋음) |
| **신호등** | 매수(GREEN), 관망(YELLOW), 매도(RED) 신호 |
| **허위매물 의심** | 시세 대비 비정상적 가격의 매물 탐지 |
| **네고 여지** | Groq AI가 분석한 가격 협상 가능 범위 |
| **FuelType** | 연료 종류 (가솔린, 디젤, 하이브리드, 전기) |

## 🔑 핵심 파일 참조

- **ML 메인**: `ml-service/main.py`
- **가격 예측**: `ml-service/services/prediction_v12.py`
- **AI 분석**: `ml-service/services/groq_service.py`
- **User 메인**: `user-service/src/.../CarUserManagementApplication.java`
- **인증**: `user-service/src/.../security/JwtAuthenticationFilter.java`
- **Flutter 메인**: `flutter_app/lib/main.dart`

## ⚙️ 환경 설정

### 필수 환경 변수 (.env)
```env
GROQ_API_KEY=gsk_xxxx          # Groq LLM API 키
BOK_API_KEY=xxxx               # 한국은행 API 키
NAVER_CLIENT_ID=xxxx           # 네이버 API
NAVER_CLIENT_SECRET=xxxx
```

### 서비스 실행
```bash
# ML Service
cd ml-service && python -m uvicorn main:app --port 8000 --reload

# User Service
cd user-service && ./gradlew bootRun

# Flutter App
cd flutter_app && flutter run
```

